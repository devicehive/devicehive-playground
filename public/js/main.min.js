!function(n){"use strict";function i(i){return n("#footer-email").on("blur, keyup",function(){n("span#mailchimp-error").text("")}),n.ajax({type:i.attr("method"),url:i.attr("action"),data:i.serialize(),cache:!1,dataType:"json",contentType:"application/json; charset=utf-8",error:function(n){alert("Oops, something went wrong!")},success:function(i){""!==n("#footer-email").val()&&("success"!==i.result?(-1!==i.msg.indexOf("is already subscribed")?n("span#mailchimp-error").text("This email address is already subscribed to the News Digest"):n("span#mailchimp-error").text(i.msg),n("#footerSubscribeBtn").prop("disabled",!0)):(n("#footer-email").val(""),n("#subscribedMsg").fadeIn(200),setTimeout(function(){n("#subscribedMsg").fadeOut(200)},2e3)))}}),!1}n.validator.addMethod("emailRegex",function(n,i){return this.optional(i)||/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/gim.test(n)});var e={init:function(n){this.config=n,this.bindEvents()},bindEvents:function(){this.validate(this.config.form),this.enableButton(this.config.form,this.config.field,this.config.btn)},validate:function(i){n.validator.methods.emailRegex=function(n,i){return this.optional(i)||/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/gim.test(n)},n(i).validate({rules:{EMAIL:{emailRegex:!0,required:!0}},messages:{EMAIL:{emailRegex:"Please enter a valid email address."}},submitHandler:function(i){n(i).submit()}})},enableButton:function(n,i,e){i.on("blur keyup",function(){n.valid()?e.prop("disabled",!1):e.prop("disabled",!0)})}},o={init:function(i){var e=this;this.config=i,this.bindEvents(),this.footerBar=this.config.footerBar.clone(),window.innerWidth<992&&(e.config.navbar.hide(),n(window).on("orientationchange",function(){e.hideMenu()})),n(window).on("resize",function(){n("body").removeClass(e.config.classToBodyAdd),window.innerWidth<992?e.config.navbar.hide():e.config.navbar.show()})},bindEvents:function(){var i=this,e=n("body");i.config.menuBtn.on("click",this.processMenu),i.config.navItem.on("click",function(){e.hasClass(i.config.classToBodyAdd)&&(n("#headerNav").slideUp(),e.removeClass(i.config.classToBodyAdd))})},processMenu:function(){var i=o;n("body").hasClass(i.config.classToBodyAdd)?i.hideMenu():i.showMenu()},hideMenu:function(){n("body").removeClass(this.config.classToBodyAdd),this.config.navbar.slideUp()},showMenu:function(){n("body").addClass(this.config.classToBodyAdd),this.config.navbar.append(this.footerBar).slideDown()}},t={init:function(n){this.config=n,this.processTabs(),this.hideTabs()},processTabs:function(){var i=t;this.config.tabs.find(this.config.tab).each(function(e,o){n(o).on("click",i.config.tabBtn,function(){n(this).hasClass("open")?(n(this).removeClass("open"),n(o).find(i.config.tabContent).slideUp()):(n(this).addClass("open"),n(o).find(i.config.tabContent).slideDown())})})},hideTabs:function(){this.config.tabs.find(this.config.tabContent).hide()}},s={init:function(n){this.config=n,this.bindEvents()},bindEvents:function(){var i=s;this.config.panel.each(function(e,o){n(o).on("click",i.config.copyBtn,function(){var e=n(o).find(s.config.textToCopy),t=n(o).find(i.config.copiedName).text();i.copyToClipboard(e),i.showMsg(t)})})},copyToClipboard:function(i){var e=n("<input>");if(n("body").append(e),e.val(n(i).text()),navigator.userAgent.match(/ipad|ipod|iphone/i)){var o=e.get(0),t=o.contentEditable,s=o.readOnly;o.contentEditable=!0,o.readOnly=!1;var a=document.createRange();a.selectNodeContents(o);var c=window.getSelection();c.removeAllRanges(),c.addRange(a),o.setSelectionRange(0,999999),o.contentEditable=t,o.readOnly=s}else e.val(n(i).text()).select();document.execCommand("copy"),e.blur(),e.remove()},showMsg:function(n){this.config.copyMsg.text(n+"copied").addClass("copied"),setTimeout(function(){s.config.copyMsg.text("").removeClass("copied")},2e3)}},a={init:function(n){this.config=n,this.checkUser()},clearCookies:function(){Cookies.remove("connect.sid"),window.location="/logout"},getCurrentUser:function(){this.config.signIn.hide(),this.config.detailPage.show(),this.loadContent()},checkUser:function(){Cookies.get("connect.sid")?this.getCurrentUser():this.userIsMissing()},loadContent:function(){var i=this;this.config.loader.show(),n.get("info",function(n){i.config.detailPage.html(n)}).done(function(){i.config.loader.hide(),n(i.config.logoutBtn).on("click",i.clearCookies),s.init({panel:n(".hasCopy"),copyBtn:".copyBtn",copyMsg:n("#copyMsg"),textToCopy:"code",copiedName:".copy__heading"}),t.init({tabs:n("#detailsTabs"),tab:".details__tab",tabBtn:".tab__btn",tabContent:".tab__content"})}).fail(function(e){i.config.loader.hide(),i.config.relogin.show(),n(i.config.logoutBtn).on("click",i.clearCookies),e.status<404?i.config.keyExpiredMsg.show():i.config.serverErrorMsg.show()})},userIsMissing:function(){this.config.signIn.show(),this.config.detailPage.hide(),n(".mobile__logout").hide()}};n(function(){var t=n(".header");n(window).scrollTop()>100?t.addClass("bg-header"):t.removeClass("bg-header"),n(window).on("scroll",function(){n(window).scrollTop()>100?t.addClass("bg-header"):t.removeClass("bg-header")});var s=n("#footerEmailForm");s.length>0&&n(s.find('input[type="submit"]')).bind("click",function(n){n&&n.preventDefault(),i(s)}),a.init({logoutBtn:".logout-btn",loader:n(".loading"),signIn:n("#sign-in"),detailPage:n("#playground-detail"),keyExpiredMsg:n("#key-expired"),serverErrorMsg:n("#server-error"),relogin:n("#playground-relogin")}),o.init({footerBar:n("#footerLinks"),menuBtn:n("#mobileBtn"),classToBodyAdd:"mobile-menu-visible",navbar:n("#headerNav"),navItem:n(".nav__item")}),e.init({form:n("#footerEmailForm"),btn:n("#footerSubscribeBtn"),field:n("#footer-email")})})}(jQuery);